---
isOriginal: true
category: Spring Boot 2.7.x
tag: Spring Boot
date: 2022-04-30
---

# é›†æˆ Knife4j

## ğŸˆ å·å¤–

æœ€è¿‘ï¼Œå…¬ä¼—å·ä¹‹å¤–ï¼Œå»ºç«‹äº†å¾®ä¿¡äº¤æµç¾¤ï¼Œä¸å®šæœŸä¼šåœ¨ç¾¤é‡Œåˆ†äº«å„ç§èµ„æºï¼ˆå½±è§†ã€IT ç¼–ç¨‹ã€è€ƒè¯•æå‡â€¦â€¦ï¼‰&çŸ¥è¯†ã€‚å¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥**æ‰«ç æˆ–è€…åå°æ·»åŠ å°ç¼–å¾®ä¿¡å¤‡æ³¨å…¥ç¾¤**ã€‚è¿›ç¾¤å**ä¼˜å…ˆçœ‹ç¾¤å…¬å‘Š**ï¼Œ**å‘¼å«ç¾¤ä¸­ã€èµ„æºåˆ†äº«å°åŠ©æ‰‹ã€‘**ï¼Œè¿˜èƒ½å…è´¹å¸®æ‰¾èµ„æºå“¦ï½

<center>
<img src="/contact/wxgroup.jpg" width="150"> 
</center>

## å‰è¨€

ä¹‹å‰ä»‹ç»äº†å¦‚ä½•åœ¨ `Spring Boot` ä¸­é›†æˆ `Swagger2` å’Œ `Swagger3`ï¼Œå¯¹äºæˆ‘ä»¬æ—¥å¸¸çš„æ¥å£ç®¡ç†å·²ç»å¤Ÿç”¨äº†ã€‚ä½†æ˜¯ä½œä¸ºä¸€ä¸ªé¢œå€¼å…šï¼Œæ— è®ºæ˜¯ `Swagger2` è¿˜æ˜¯ `Swagger3`ï¼Œéƒ½éš¾ä»¥æ»¡è¶³æˆ‘ä»¬çš„å®¡ç¾ã€‚è€Œä¸” `Swagger2` å’Œ `Swagger3` éƒ½å·²ç»å¥½ä¹…æ²¡æ›´æ–°äº†ï¼Œæ›´æ–°è¿˜æ˜¯æ¯”è¾ƒæ…¢çš„ã€‚

å¶ç„¶ä¹‹é—´å‘ç°äº†ä¸€ä¸ªå›½äº§çš„æ¥å£æ–‡æ¡£ç®¡ç†å·¥å…· [Knife4j](https://doc.xiaominfo.com/knife4j/)ï¼Œå®ƒåŸºäº `Swagger` è€Œæ¥ï¼Œä½†æ˜¯åˆå¯¹ `Swagger` è¿›è¡Œäº†å¢å¼ºï¼Œå¢åŠ ä¸¤ä¸ªè¶Šæ¥è¶Šå¤šçš„ä¸ªæ€§åŒ–éœ€æ±‚ï¼Œå¯ä»¥è¯´å…¼å…·é¢œå€¼ä¸å®åŠ›äº†ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œå¦‚ä½•åœ¨ `Spring Boot` ä¸­é›†æˆ `Knife4j` è¿™ä¸ªæ¥å£æ–‡æ¡£ç®¡ç†å·¥å…·ã€‚

## é›†æˆè¿‡ç¨‹

### åˆ›å»º Spring Boot é¡¹ç›®

æ—¢ç„¶è¦åœ¨ `Spring Boot` ä¸­ä½¿ç”¨ `Knife4j`ï¼Œé‚£é¦–å…ˆå°±å¾—åˆ›å»ºä¸€ä¸ª `Spring Boot` é¡¹ç›®ã€‚å½“ç„¶ï¼Œæˆ‘åœ¨ä¹‹å‰å·²ç»å†™è¿‡æ–‡ç« ä»‹ç»å¦‚ä½•åˆ›å»º `Spring Boot` é¡¹ç›®äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¸å†èµ˜è¿°ã€‚å¦‚æœä½ è¿˜å¯¹ `Spring` Boot åˆ›å»ºæ–¹å¼ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š[Spring Boot åŸºç¡€æ•™ç¨‹ï¼šåˆ›å»ºé¡¹ç›®çš„ 3 ç§æ–¹å¼ | JavaPark](https://cunyu1943.github.io/JavaPark/java/spring-boot/the-methods-to-create-springboot-project.html)

### æ·»åŠ ä¾èµ–

æ—¢ç„¶æ˜¯ç”¨ `Maven` æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œé‚£æˆ‘ä»¬åœ¨é¡¹ç›® `pom.xml` ä¸­å¼•å…¥ `Knife4j` çš„ç›¸å…³ä¾èµ–åŒ…ï¼Œå¼•å…¥ä»£ç å¦‚ä¸‹ã€‚

```xml
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-spring-boot-starter</artifactId>
    <version>3.0.3</version>
</dependency>
```

### é…ç½®æ·»åŠ 

æ¥ç€åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªé…ç½®åŒ… `config`ï¼Œç”¨äºé…ç½® `Swagger` çš„é…ç½®ä¾èµ–ã€‚åœ¨è¿™é‡Œå¯ä»¥é…ç½®æ‰«æçš„ `controller` æ‰€åœ¨çš„åŒ…ï¼Œè®¾ç½®æ¥å£æ–‡æ¡£çš„æ ‡é¢˜ã€æè¿°ã€ä½œè€…ä¿¡æ¯ç­‰ã€‚

è¿™é‡Œå…¶å®å’Œ `Swagger2` å’Œ `Swagger3` å¾ˆç›¸ä¼¼ï¼Œ`Swagger` ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡é…ç½®ç±»æ¥æŒ‡å®šè¿™äº›ä¿¡æ¯ã€‚

```java
package com.cunyu.springbootknife4jdemo.config;

import com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
@EnableKnife4j
public class Knife4jConfiguration {

    @Bean
    public Docket createRestApi() {
        return new Docket(DocumentationType.SWAGGER_2)
                .useDefaultResponseMessages(false)
                .apiInfo(apiInfo())
                .select()                .apis(RequestHandlerSelectors.basePackage("com.cunyu.springbootknife4jdemo.controller"))
                .paths(PathSelectors.any())
                .build();

    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .description("Kinfe4j é›†æˆæµ‹è¯•æ–‡æ¡£")
                .contact(new Contact("æ‘é›¨é¥", "https://cunyu.gitub.io/JavaPark", "747731461@qq.com"))
                .version("v1.1.0")
                .title("APIæµ‹è¯•æ–‡æ¡£")
                .build();
    }

}

```

### ç¼–å†™ Controller å±‚

æ¥ç€æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæµ‹è¯•çš„ `controller`ï¼Œç”¨äºåœ¨ `Knife4j` ä¸­å±•ç¤ºç”¨ï¼Œä»£ç å¦‚ä¸‹ã€‚

```java
@Api(tags = "æµ‹è¯•æ¨¡å—")
@RestController
public class DemoController {
    @ApiImplicitParam(name = "name", value = "å§“å", required = true)
    @ApiOperation(value = "å…¥é—¨ç¨‹åºï¼ŒHello World")
    @PostMapping("/helloWorld")
    public ResponseEntity<String> helloWorld(@RequestParam(value = "name") String name) {
        return ResponseEntity.ok("Hello Worldï¼Œ" + name);
    }
}
```

### å¯åŠ¨æµ‹è¯•

ç„¶åå°†é¡¹ç›®å¯åŠ¨èµ·æ¥ï¼Œæ¥ç€åˆ°æµè§ˆå™¨ä¸­å»æ‰“å¼€ `http://localhost:8080/doc.html`ï¼Œå°±ä¼šå‡ºç°ä»¥ä¸‹çš„ä¸»ç•Œé¢ã€‚è¿™é‡Œæœ‰æˆ‘ä»¬ä¹‹å‰åœ¨é…ç½®ç±»ä¸­æ‰€è®¾ç½®çš„ä¸€äº›æ¥å£ä¿¡æ¯ï¼Œæ­¤å¤–ï¼Œè¿˜å¯¹æ¥å£è¿›è¡Œäº†ç»Ÿè®¡ã€‚å› ä¸ºæˆ‘ä»¬ä»£ç ä¸­åªå†™äº†ä¸€ä¸ª `POST` çš„è¯·æ±‚ï¼Œæ‰€ä»¥è¿™é‡Œç»Ÿè®¡å‡ºåªæœ‰ä¸€ä¸ª `POST` è¯·æ±‚ã€‚

![](assets/20220430-knife4j/8b6f5004e1f91d1abcffbb8b4d380b2e-20240205215323505.webp)

æ‰“å¼€å…·ä½“æ¥å£ï¼Œè¿™é‡Œå°±æœ‰æˆ‘ä»¬æ¥å£çš„è¯·æ±‚å’Œå“åº”çš„ä¸€äº›æƒ…å†µè¯´æ˜ã€‚

![](assets/20220430-knife4j/3365c280ea9b48d4fde5b80e3d0847bb-20240205215323532.webp)

ç‚¹å‡»å·¦ä¾§ `è°ƒè¯•` æŒ‰é’®ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ `Knife4j` ä¸­æµ‹è¯•æˆ‘ä»¬çš„æ¥å£ã€‚

![](assets/20220430-knife4j/cf1fa1440de711f1e1788c5897d31808-20240205215323517.webp)

![](assets/20220430-knife4j/10ee44265c16148cbed2a8a34a676f6a-20240205215323531.webp)

## è¸©è¿‡çš„å‘

å½“ç„¶ï¼Œå¦‚æœä½ æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤é¡ºåˆ©æ‰“å¼€äº† `Knife4j` çš„æ–‡æ¡£ç®¡ç†é¡µé¢ï¼Œé‚£æ¥ä¸‹æ¥çš„å†…å®¹ä½ å¤§å¯ä¸å¿…äº†è§£ã€‚ä½†å¦‚æœä½ æŒ‰ç…§ä¸Šè¾¹æ­¥éª¤æ­å»ºè¿‡ç¨‹ä¸­ä¹Ÿå‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¸å¦¨çœ‹çœ‹ä»¥ä¸‹æ˜¯å¦æœ‰ä½ é‡åˆ°çš„ `Bug`ã€‚

### ç©ºæŒ‡é’ˆå¼‚å¸¸

é¦–å…ˆæ˜¯æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ã€‚

```sh
Failed to start bean 'documentationPluginsBootstrapper'; nested exception is java.lang.NullPointerException
```

ç»è¿‡æŸ¥è¯¢èµ„æ–™å¯çŸ¥ï¼Œè¿™æ˜¯å› ä¸º `Springfox` ä½¿ç”¨çš„è·¯å¾„åŒ¹é…æ˜¯åŸºäº `AntPathMatcher` çš„ï¼Œä½†æ˜¯ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯ `Spring Boot 2.6.x` ç‰ˆæœ¬ï¼Œæ­£å¥½è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯ `PathPatternMatcher`ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥è¿™é‡Œä¸»è¦å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥è§£å†³ã€‚

ç¬¬ä¸€ç§ï¼Œæ— å¯åšéï¼Œå°±æ˜¯å°†æˆ‘ä»¬çš„ `Spring Boot` çš„ç‰ˆæœ¬é™ä½ï¼Œä» `2.6.x` é™åˆ° `2.5.x`ï¼Œæ­¤æ—¶å°±åº”è¯¥æ˜¯å¯ä»¥äº†ï¼Œè¿™é‡Œå¯ä»¥è‡ªå·±å»è¯•ä¸€ä¸‹ã€‚

ç¬¬äºŒç§ï¼Œæ—¢ç„¶æˆ‘ä»¬éƒ½å·²ç»ç”¨ä¸Š `2.6.x` ç‰ˆæœ¬äº†ï¼Œé‚£æˆ‘ä»¬å°±æ˜¯ä¸æƒ³é™ä½ç‰ˆæœ¬å’‹æ•´ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä¸»ç¨‹åºå¯åŠ¨ç±»ä¸­åŠ ä¸Š `@EnableWebMvc` è¿™ä¸ªæ³¨è§£ã€‚ç„¶åå†æ¬¡å¯åŠ¨ç¨‹åºï¼Œä½ å°±ä¼šå‘ç°å¯åŠ¨æˆåŠŸäº†ï¼

```java
@EnableWebMvc
@SpringBootApplication
public class SpringbootKnife4jDemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringbootKnife4jDemoApplication.class, args);
    }
}
```

### è¯·æ±‚è·¯å¾„æœªæ‰¾åˆ°

ä¸€å±±æ”¾è¿‡ä¸€å±±æ‹¦ï¼Œä»¥ä¸ºç¿»è¿‡äº†ä¸Šé¢çš„å±±ï¼Œå°±èƒ½æˆåŠŸäº†ã€‚æ²¡æƒ³åˆ°å‡ºå¸ˆä¸åˆ©ï¼Œè¿™ä¸åˆé‡åˆ°äº†æŠ¥é”™è¯·æ±‚è·¯å¾„æœªæ‰¾åˆ°ã€‚

å½“æˆ‘ä»¬æˆåŠŸå¯åŠ¨é¡¹ç›®åï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:8080/doc.html`ï¼Œå´æ²¡æƒ³åˆ°è¿æ¥æˆ‘ä»¬çš„ä¸æ˜¯æˆåŠŸç•Œé¢ï¼Œè€Œæ˜¯ä¸‹é¢çš„ `Whitelabel Error Page`ã€‚

ç„¶ååˆ° `IDEA` ä¸­ä¸€çœ‹æ—¥å¿—ï¼Œç¨‹åºç…§å¸¸è¿è¡Œï¼Œä¹Ÿæ²¡æŠ¥é”™ï¼Œä½†æ˜¯ç»™æˆ‘ä»¬æŠ›å‡ºäº†ä¸€ä¸ª `WARN`ï¼Œè­¦å‘Šä¿¡æ¯å¦‚ä¸‹ï¼š

```sh
No mapping for GET /doc.html
```

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸ºäº†è§£å†³ä¸Šé¢çš„ `Bug` è€Œä½¿ç”¨åˆ°äº† `@EnableWebMvc`ï¼Œç”±äºå®ƒå®ç°äº† `WebMvcConfigurer` æ¥å£ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æˆ‘ä»¬è®¿é—®è¯†åˆ«ã€‚

è¿™æ—¶å€™é—®é¢˜å°±æ¥äº†ï¼Œä¸Šé¢åˆéœ€è¦è¿™ä¸ªæ³¨è§£ï¼Œä½†æ˜¯ä¸‹é¢è¿™ä¸ªé—®é¢˜åˆä¸éœ€è¦ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

å…¶å®å¾ˆç®€å•ï¼Œæ—¢ç„¶æˆ‘ä»¬è¦ä¿ç•™ `@EnableWebMvc`ï¼Œé‚£æˆ‘ä»¬å»é…ç½®ä¸ªè§„åˆ™ä¸å°±å¥½äº†ã€‚

åœ¨é¡¹ç›®çš„ `config` åŒ…ä¸‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªé…ç½®ç±» `WebMvcConfigurer` è®°æˆ `WebMvcConfigurationSupport` ç±»ï¼Œæ¥ç€å°† `dom.html` è¿‡æ»¤æ‰å³å¯ã€‚

```java
@Configuration
public class WebMvcConfigurer extends WebMvcConfigurationSupport {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/**").addResourceLocations("classpath:/static/");
        registry.addResourceHandler("doc.html").addResourceLocations("classpath:/META-INF/resources/");
        registry.addResourceHandler("/webjars/**").addResourceLocations("classpath:/META-INF/resources/webjars/");
        super.addResourceHandlers(registry);
    }
}
```

å®Œæˆä¸Šè¿°é…ç½®åï¼Œå†å»è¿è¡Œé¡¹ç›®ï¼Œå†åˆ°æµè§ˆå™¨ä¸­å»è®¿é—® `http://localhost:8080/doc.html` åº”è¯¥å°±èƒ½æ­£å¸¸è®¿é—® Knife4j æ–‡æ¡£ç®¡ç†é¡µé¢äº†ã€‚

## æ€»ç»“

ä»¥ä¸Šå°±æ˜¯ `Spring Boot` ä¸­é›†æˆ `Knife4j` æ–‡æ¡£ç®¡ç†å·¥å…·çš„å†…å®¹äº†ï¼Œè¿™é‡Œä¸»è¦è®²äº†ä¸‹å¦‚ä½•é›†æˆå¹¶ä¸”è¿›è¡Œä¸€ä¸ªæœ€ç®€å•çš„æ¥å£è°ƒè¯•ï¼Œå…³äºæ›´å¤š `Knife4j` çš„ä¸ªæ€§åŒ–åŠŸèƒ½ï¼Œå¯ä»¥å»å®ƒçš„å®˜ç½‘äº†è§£ä¸‹ã€‚

æ­¤å¤–ï¼Œå¯¹äºæ–‡ä¸­é›†æˆæ˜¯æ‰€é‡åˆ°çš„ `Bug`ï¼Œå¦‚æœä½ æ²¡æœ‰é‡åˆ°ï¼Œé‚£ä¹ˆä½ åº”è¯¥é¡ºåˆ©é›†æˆäº†ï¼Œå¦‚æœä½ ä¹Ÿæœ‰é‡åˆ°ï¼Œé‚£ä¹ˆä¸å¦¨è·Ÿç€æˆ‘å»è¯•ä¸€ä¸‹è§£å†³çš„åŠæ³•ã€‚

æœ€åçš„æœ€åï¼Œå…³äºæœ¬æ–‡ä¸­æ‰€æ¶‰åŠçš„ä»£ç ï¼Œæˆ‘å·²ç»å¼€æºäº†ï¼Œæœ‰éœ€è¦åˆ°å°ä¼™ä¼´å¯ä»¥å»è‡ªå–å“¦ã€‚

>   [springboot-knife4j-demo](https://github.com/cunyu1943/java-learning-demos/tree/main/springboot-knife4j-demo)
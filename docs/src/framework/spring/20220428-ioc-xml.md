---
isOriginal: true
category: Spring ç³»åˆ—
tag:
    - Spring
date: 2022-04-28
---


# IoC ç®€ä»‹åŠå…¥é—¨å®ä¾‹ï¼ˆXML ç‰ˆï¼‰

## ğŸˆ å·å¤–

æœ€è¿‘ï¼Œå…¬ä¼—å·ä¹‹å¤–ï¼Œå»ºç«‹äº†å¾®ä¿¡äº¤æµç¾¤ï¼Œä¸å®šæœŸä¼šåœ¨ç¾¤é‡Œåˆ†äº«å„ç§èµ„æºï¼ˆå½±è§†ã€IT ç¼–ç¨‹ã€è€ƒè¯•æå‡â€¦â€¦ï¼‰&çŸ¥è¯†ã€‚å¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥**æ‰«ç æˆ–è€…åå°æ·»åŠ å°ç¼–å¾®ä¿¡å¤‡æ³¨å…¥ç¾¤**ã€‚è¿›ç¾¤å**ä¼˜å…ˆçœ‹ç¾¤å…¬å‘Š**ï¼Œ**å‘¼å«ç¾¤ä¸­ã€èµ„æºåˆ†äº«å°åŠ©æ‰‹ã€‘**ï¼Œè¿˜èƒ½å…è´¹å¸®æ‰¾èµ„æºå“¦ï½

<center>
<img src="/contact/wxgroup.jpg" width="150"> 
</center>

## IoC

IoCï¼ˆ`Inversion of Control`ï¼‰ï¼Œä¸­æ–‡ååˆå«åšæ§åˆ¶åè½¬ã€‚

é’ˆå¯¹å½“å‰ä¹¦å†™ä»£ç æ—¶è€¦åˆåº¦åé«˜çš„ç°çŠ¶ï¼Œå¤§ç‰›ä»¬æå‡ºäº†å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚é‚£å°±æ˜¯åœ¨ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œä¸è¦å†é€šè¿‡ä¸»åŠ¨ä½¿ç”¨ `new` æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è½¬å˜ä¸ºç”±å¤–éƒ¨æ¥æä¾›å¯¹è±¡ã€‚è€Œè¿™ç§å°†å¯¹è±¡çš„åˆ›å»ºæ§åˆ¶æƒä»ç¨‹åºè½¬ç§»åˆ°**å¤–éƒ¨**çš„æ€æƒ³å°±å«åš**æ§åˆ¶åè½¬**ã€‚

æ€»ç»“æ¥è¯´ï¼ŒIoC å°±æ˜¯æŒ‡åœ¨ä½¿ç”¨å¯¹è±¡æ—¶ç”±ä¸»åŠ¨ `new` åˆ›å»ºå¯¹è±¡çš„æ–¹å¼è½¬æ¢ä¸ºç”±å¤–éƒ¨æä¾›ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¯¹è±¡çš„åˆ›å»ºæ§åˆ¶æƒç”±ç¨‹åºè½¬ç§»åˆ°äº†å¤–éƒ¨ï¼Œè¿™ä¸ªæ€æƒ³å°±å«åšæ§åˆ¶åè½¬ã€‚è€Œ Spring å®ç°äº† IoC æ€æƒ³ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå®¹å™¨ç”¨æ¥å……å½“ IoC æ€æƒ³ä¸­çš„å¤–éƒ¨ï¼Œè€Œæˆ‘ä»¬å°†è¿™ä¸ªå®¹å™¨ç§°ä¸º IoC å®¹å™¨ã€‚

IoC å®¹å™¨ä¸“é—¨è´Ÿè´£å¯¹è±¡åˆ›å»ºã€åˆå§‹åŒ–ç­‰ä¸€ç³»åˆ—å·¥ä½œï¼Œè€Œè¿™äº›ç”± IoC å®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡æˆ‘ä»¬ç»Ÿç§°ä¸º `Bean`ã€‚

## DI

DIï¼ˆ`Dependency Injection`ï¼‰ï¼Œä¸­æ–‡ååˆå«åšä¾èµ–æ³¨å…¥ã€‚

IoC å®¹å™¨è™½ç„¶è´Ÿè´£äº†åˆ›å»ºå’Œåˆå§‹åŒ–å¯¹è±¡ç­‰ä¸€ç³»åˆ—å·¥ä½œï¼Œä½†å®é™…ä¸Šä¸åŒçš„å¯¹è±¡ä¹‹é—´æˆ–å¤šæˆ–å°‘å­˜åœ¨ç€ä¾èµ–å…³ç³»ï¼Œè¿™ä¸ªé—®é¢˜ IoC æ˜¯è§£å†³ä¸äº†çš„ï¼Œå› æ­¤æ‰æœ‰äº† DI çš„æå‡ºã€‚ä¾èµ–æ³¨å…¥å®ç°äº†å®¹å™¨ä¸­ Bean ä¸ Bean ä¹‹é—´ä¾èµ–å…³ç³»çš„å»ºç«‹ã€‚

## å…¥é—¨æ¡ˆä¾‹

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ IoC çš„ä¸€ä¸ªå…¥é—¨å®ä¾‹ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Maven é¡¹ç›®ï¼Œå¦‚æœä¸å¤ªç†Ÿæ‚‰å¦‚ä½•åˆ›å»ºï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ•™ç¨‹ -> [Maven å…¥é—¨æ‰‹å†Œï¼šä½¿ç”¨ IDEA åˆ›å»º Maven é¡¹ç›® | JavaPark](https://cunyu1943.github.io/JavaPark/java/maven/maven-project-with-idea.html)

æ¥ç€æˆ‘ä»¬åˆ†åˆ«åˆ›å»º DAO å±‚å’Œ Service å±‚æ¥å£ï¼Œå¹¶å®ç°å…¶æ¥å£ï¼Œæœ€ååˆ™æ˜¯åœ¨ä¸»ç¨‹åºå…¥å£ä¸­è°ƒç”¨ï¼Œåˆ›å»ºåçš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

![](assets/20220428-ioc-xml/c8be93c33fc982de23d52b6bfa74034d.webp)

-   **DAO å±‚**

```java
public interface BookDao {
    public void save();
}
```

```java
public class BookDaoImpl implements BookDao {
    @Override
    public void save() {
        System.out.println("book dao save â€¦â€¦");
    }
}
```

- **Service å±‚** 

```java
public interface BookService {
    public void save();
}
```

```java
public class BookServiceImpl implements BookService {
    private BookDao bookDao = new BookDaoImpl();

    @Override
    public void save() {
        System.out.println("book service save â€¦â€¦");
        bookDao.save();
    }
}
```

### ä¼ ç»Ÿæ–¹å¼

æˆ‘ä»¬å…ˆä»¥ä¼ ç»Ÿçš„æ–¹å¼ï¼Œé€šè¿‡æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ª `BookService` å¯¹è±¡ï¼Œè°ƒç”¨æ¥å£åæ‰“å°ç»“æœå¦‚ä¸‹ã€‚

```java
public class AppCommon {
    public static void main(String[] args) {
        BookService bookService = new BookServiceImpl();
        bookService.save();
    }
}
```

![](assets/20220428-ioc-xml/e754b26be2e317997753c9e9896564db.webp)

### IoC æ–¹å¼

ä»¥ä¸Šè¿˜æ˜¯é€šè¿‡æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹åˆ©ç”¨ IoC çš„æ–¹å¼ã€‚

é¦–å…ˆï¼Œè¦ä½¿ç”¨ IoC  çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®çš„ `pom.xml` ä¸­å¼•å…¥ Spring çš„ä¾èµ–ã€‚ 

```xml
<dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>5.3.16</version>
        </dependency>    
</dependencies>
```

æ¥ç€æˆ‘ä»¬åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œå‘ŠçŸ¥ IoC å®¹å™¨éœ€è¦ç®¡ç†çš„å¯¹è±¡ã€‚

åœ¨ `resource` ç›®å½•ä¸‹åˆ›å»º Spring é…ç½®æ–‡ä»¶ `applicationContext.xml`ï¼Œç„¶åé…ç½®éœ€è¦ç®¡ç†çš„ `BookService` å’Œ `BookDao` å¯¹è±¡ã€‚

```xml
<!--  é…ç½® bean  -->
<bean id="bookDao" class="com.cunyu.dao.impl.BookDaoImpl"/>
<bean id="bookService" class="com.cunyu.service.impl.BookServiceImpl"/>
```

æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸»ç¨‹åºå…¥å£ï¼Œé€šè¿‡ä»é…ç½®æ–‡ä»¶ä¸­è·å–å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å¯¹åº”æ–¹æ³•ã€‚

```java
public class AppIoC {
    public static void main(String[] args) {
        //    åŠ è½½é…ç½®æ–‡ä»¶ï¼Œè·å– IoC å®¹å™¨
        ApplicationContext app = new ClassPathXmlApplicationContext("applicationContext.xml");
        //    è·å– Bean
        BookService bookService = (BookService) app.getBean("bookService");
        bookService.save();
    }
}
```

![](assets/20220428-ioc-xml/aaceffc537d9c1bf2445a6c067b0d07a.webp)

### DI æ–¹å¼

ä¹‹å‰çš„æ–¹å¼æœ‰ä¸€ç‚¹ä¸çŸ¥é“æœ‰æ²¡æœ‰æ³¨æ„ï¼Œé‚£å°±æ˜¯åœ¨ Service å±‚ä¸­ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼è¿˜æ˜¯ IoC çš„æ–¹å¼ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡æ‰‹åŠ¨åˆ›å»ºçš„ `BookDao` çš„å¯¹è±¡ï¼Œé‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹å¼è®©æˆ‘ä»¬ä¸ç”¨é€šè¿‡æ‰‹åŠ¨åˆ›å»º `BookDao` å¯¹è±¡çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæœ‰çš„ï¼Œé‚£å°±æ˜¯ DIã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹åŸºäºä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼Œæ¥è§£å†³ `BookDao` å’Œ `BookService` ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚

DAO å±‚ä¸­çš„ä»£ç æˆ‘ä»¬ä¾æ—§ä¿æŒä¸å˜ï¼Œä¸»è¦ä¿®æ”¹ Service ä¸­çš„ä»£ç ï¼Œå»æ‰é€šè¿‡ `new` æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ï¼Œä¿®æ”¹å Service å±‚ çš„ä»£ç å¦‚ä¸‹ã€‚

```java
public interface BookService {
    public void save();
}
```

```java
public class BookServiceImpl implements BookService { 
    private BookDao bookDao;

    @Override
    public void save() {
        System.out.println("book service save â€¦â€¦");
        bookDao.save();
    }
    
    public void setBookDao(BookDao bookDao){
        this.bookDao = bookDao;
    }
}
```

ç„¶ååœ¨ Spring é…ç½®æ–‡ä»¶ `applicationContext` ä¸­é…ç½® `BookDao` å’Œ `BookService` çš„å…³ç³»ã€‚

```xml
<!--  é…ç½® bean  -->
<bean id="bookDao" class="com.cunyu.dao.impl.BookDaoImpl"/>
<bean id="bookService" class="com.cunyu.service.impl.BookServiceImpl">
    <!-- property è¡¨ç¤ºé…ç½®å½“å‰ Bean çš„å±æ€§
             name è¡¨ç¤ºé…ç½®å“ªä¸€ä¸ªå…·ä½“çš„å±æ€§
             ref è¡¨ç¤ºå‚ç…§çš„ Bean
             -->
    <property name="bookDao" ref="bookDao"/>
</bean>
```

æœ€åï¼Œç”¨ IoC æ–¹å¼ä¸­åŒæ ·çš„æ–¹å¼ï¼Œåœ¨ä¸»ç¨‹åºå…¥å£è·å–é…ç½®æ–‡ä»¶ï¼Œç„¶åè·å–å¯¹è±¡è°ƒç”¨æ¥å£å³å¯ã€‚

![](assets/20220428-ioc-xml/1e4b4d41e460b1dd7638bee473f8b9de.webp)

## æ€»ç»“

æœ¬æ–‡ä¸»è¦è®²äº† IoC å’Œ DI çš„å®šä¹‰ï¼Œç„¶åå¯¹æ¯”äº†ä¼ ç»Ÿæ–¹å¼ã€IoC æ–¹å¼å’Œ DI æ–¹å¼ç”¨æ¥ç®¡ç†å¯¹è±¡ï¼Œè€Œä¸”æœ€ç»ˆä¸‰è€…çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†å…¶ä¸­è¿˜æ˜¯æœ‰ä¸€ç‚¹çš„åŒºåˆ«ã€‚é€šè¿‡å¼•å…¥ Spring ä¸­çš„ IoC å’Œ DI ç‰¹æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½®ç›¸å…³é…ç½®å³å¯ï¼Œè€Œä¸ç”¨å†å»é€šè¿‡ `new` æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡ä»¥åŠç®¡ç† Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚

æœ€åï¼Œå…³äºæœ¬æ–‡çš„ç¤ºä¾‹ä»£ç ï¼Œæˆ‘å·²ç»ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“ï¼Œæœ‰éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥è‡ªå–ã€‚

>   [Spring-IoC-Demo](https://github.com/cunyu1943/java-learning-demos/tree/main/spring-ioc-demo)